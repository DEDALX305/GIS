window.KAMENT||(window.KAMENT={});KAMENT._rootId="kament_comments";KAMENT._domain="svkament.ru";KAMENT._popupWnd="kament_popupWnd";KAMENT.main_iframe=void 0;KAMENT.mouse_x=0;KAMENT.mouse_y=0;KAMENT.old_ie=function(){var a=document.createElement("div");a.innerHTML="\x3c!--[if lt IE 8]><i></i><![endif]--\x3e";return 0<a.getElementsByTagName("i").length?!0:!1}();KAMENT.addEvent=function(a,b,c){return a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)};
KAMENT.hasClass=function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))};KAMENT.addClass=function(a,b){KAMENT.hasClass(a,b)||(a.className=a.className+" "+b)};KAMENT.removeClass=function(a,b){KAMENT.hasClass(a,b)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "))};KAMENT.Error=function(a){console.error("[KAMENT]error: "+a)};
KAMENT.getMetaValue=function(a){var b=document.getElementsByTagName("meta");for(i=0;i<b.length;i++)if(b[i].getAttribute("property")==a)return b[i].getAttribute("content");return""};KAMENT.isBrowserOk=function(){return!KAMENT.old_ie};KAMENT.getOffset=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{top:c,left:b}};
KAMENT.colorGetter={colorNames:{aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",
darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",
green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",
lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",
orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",
tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},parseSingle:function(a){return parseInt(a+a,16)},prepareResult:function(a){a=a.replace(/ /g,"").toLowerCase();this.colorNames[a]&&(a="#"+this.colorNames[a]);var b=256,c=256,d=256;0==a.indexOf("#")?(a=a.slice(1),3==a.length?(b=this.parseSingle(a.slice(0,1)),c=this.parseSingle(a.slice(1,2)),d=this.parseSingle(a.slice(2,
3))):6==a.length&&(b=parseInt(a.slice(0,2),16),c=parseInt(a.slice(2,4),16),d=parseInt(a.slice(4,6),16))):0==a.indexOf("rgb")&&(a=a.match(/^rgba?\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/))&&4<=a.length&&(b=parseInt(a[1],10),c=parseInt(a[2],10),d=parseInt(a[3],10));return{r:b,g:c,b:d,luminance:(.3*b+.59*c+.11*d)/256}},getColor:function(a){var b;window.getComputedStyle?(b=window.getComputedStyle(a,null),b=b.getPropertyValue("color")):a.currentStyle&&(b=a.currentStyle.color);return this.prepareResult(b)},
getBackgroundColor:function(a){for(var b;a;){window.getComputedStyle?(b=window.getComputedStyle(a,null),b=b.getPropertyValue("background-color")):a.currentStyle&&(b=a.currentStyle.backgroundColor);if(b&&"transparent"!=b&&"rgba(0, 0, 0, 0)"!=b)break;if(a==document.body){b="#ffffff";break}a=a.parentNode}return this.prepareResult(b)}};
KAMENT.darkTheme=function(){var a=document.createElement("P");document.getElementById(this._rootId).appendChild(a);color=KAMENT.colorGetter.getBackgroundColor(a);a.parentNode.removeChild(a);return color?128<color.r||128<color.g||128<color.b?!1:!0:!1};
KAMENT.linkColor=function(){function a(a){a=a.toString(16);return 1==a.length?"0"+a:a}var b=document.createElement("a");b.setAttribute("href","#");document.getElementById(this._rootId).appendChild(b);color=KAMENT.colorGetter.getColor(b);b.parentNode.removeChild(b);return color?"#"+a(color.r)+a(color.g)+a(color.b):""};KAMENT.iframeLoaded=function(){window.location.hash.match(/^#kament_comments(\/(.*))*$/)&&KAMENT.main_iframe.scrollIntoView()};
KAMENT.Init=function(){if(!window.kament_subdomain)KAMENT.Error("Subdomain name not set");else if(document.getElementById(this._rootId)){document.getElementById(this._rootId).innerHTML="";window.pm||this.attachScript("//"+KAMENT._domain+"/js/libs/postmessage.js");var a=document.createElement("link");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");a.setAttribute("href","//"+kament_subdomain+"."+KAMENT._domain+"/css/embed.css");document.getElementsByTagName("head")[0].appendChild(a);
var b=KAMENT.darkTheme(),c=KAMENT.linkColor(),a={};KAMENT._view&&(a.view=KAMENT._view);KAMENT._filter_type&&(a.filter_type=KAMENT._filter_type);b&&(a.dark=1);a.linkcolor=c;(b=/^#kament_comments(\/(.*))*$/.exec(window.location.hash))&&b[2]&&(a.hash=b[2]);var b=void 0!=window.kament_page_url?window.kament_page_url:this.getCurrentURL(),c=window.kament_page_title?window.kament_page_title:this.getCurrentTitle(),d=this.getMetaValue("og:description"),e=this.getMetaValue("og:image");e&&!e.match(/^https*:\/\/.*/)&&
(e.match(/^\/\/.*/)||(0!=e.indexOf(window.location.host)&&(0!=e.indexOf("/")&&(e="/"+e),e=window.location.host+e),e="//"+e),e=window.location.protocol+e);a.description=d;a.image=e;var a=this.buildIframeUrl(b,c,a),f=document.getElementById(this._rootId);this.main_iframe=document.createElement("IFRAME");this.main_iframe.setAttribute("src",a);this.main_iframe.setAttribute("id","kament_comments_root");this.main_iframe.setAttribute("name","kament_comments_root");this.main_iframe.setAttribute("style","border:none;");
this.main_iframe.setAttribute("scrolling","no");this.main_iframe.setAttribute("frameBorder","0");this.main_iframe.style.width="100%";this.main_iframe.style.height="0px";this.main_iframe.onload=function(a){KAMENT.FrameManager.registerFrame(this);KAMENT.FrameManager.init();KAMENT.updateViewport();setTimeout(KAMENT.iframeLoaded,300);KAMENT.addEvent(window,"scroll",KAMENT.updateViewport);KAMENT.addEvent(window,"resize",KAMENT.updateViewport);KAMENT.addEvent(document,"mousemove",KAMENT.mouseMoveCallback);
KAMENT.addEvent(document,"keydown",KAMENT.onKeyDown)};f.appendChild(this.main_iframe);this.main_iframe.focus();setInterval(function(){var a=f.offsetWidth;this.old_w||(this.old_w=0);a!==this.old_w&&(this.old_w=a,KAMENT.updateViewport())},1E3)}};KAMENT.updateMouseXY=function(a){a||(a=window.event);if(a)if(a.pageX||a.pageY)KAMENT.mouse_x=a.pageX,KAMENT.mouse_y=a.pageY;else if(a.clientX||a.clientY)KAMENT.mouse_x=a.clientX+document.body.scrollLeft,KAMENT.mouse_y=a.clientY+document.body.scrollTop};
KAMENT.sendHeartbeat=function(){KAMENT.alive&&(pm({target:window.frames[KAMENT.main_iframe.id],type:"alive",url:KAMENT.main_iframe.contentWindow.location}),KAMENT.alive=0)};KAMENT.mouseMoveCallback=function(){var a=KAMENT.mouse_x,b=KAMENT.mouse_y;KAMENT.updateMouseXY();if(a!=KAMENT.mouse_x||b!=KAMENT.mouse_y)KAMENT.alive=1};
KAMENT.updateViewport=function(){var a=window.innerHeight,b=KAMENT.main_iframe.getBoundingClientRect().top,c=-1;0>b?(b*=-1,c=b+a):(c=a-b,b=0,0>c&&(c=b=-1));a=KAMENT.main_iframe.getBoundingClientRect().width;KAMENT.main_iframe&&KAMENT.main_iframe.contentWindow&&window.pm&&pm({target:window.frames[KAMENT.main_iframe.id],type:"updateViewport",data:{top:b,bottom:c,width:a},url:KAMENT.main_iframe.contentWindow.location});0<=b&&0<=c&&(KAMENT.alive=1)};
KAMENT.attachScript=function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.type="text/javascript";c.setAttribute("encoding","UTF-8");c.src=a;b.appendChild(c)};
KAMENT.buildIframeUrl=function(a,b,c){var d="";window.kament_page_name&&(d=window.kament_page_name);a="//"+kament_subdomain+"."+this._domain+"/commentswidget/?page="+encodeURIComponent(d)+"&title="+encodeURIComponent(b)+"&url="+encodeURIComponent(a);for(p_name in c)a+="&"+p_name+"="+encodeURIComponent(c[p_name]);return a};KAMENT.getCurrentTitle=function(){var a=this.getMetaValue("og:title");a||(a=document.title);255<a.length&&(a=a.substring(0,255));return a};
KAMENT.getCurrentURL=function(){var a=window.location.search;a&&("?"==a.charAt(0)&&(a=a.substring(1)),a=a.split("&"),a.sort(),a="?"+a.join("&"));var b=window.location.protocol+"//"+window.location.hostname+window.location.pathname;window.location.port&&(b+=":"+window.location.port);return b+a};
KAMENT.closeModal=function(){if(KAMENT.modal_opened){var a=document.getElementById(this._popupWnd),b=document.getElementById(this._popupWnd+"_backdrop");KAMENT.removeClass(b,"KAMENT-in");KAMENT.removeClass(a,"KAMENT-in");setTimeout(function(){a.style.display="none";b.style.display="none"},300);KAMENT.modal_onclose&&(KAMENT.modal_onclose(),KAMENT.modal_onclose=null)}};
KAMENT.openModal=function(a,b){KAMENT.modal_opened=!0;var c=document.getElementById(this._popupWnd),d=document.getElementById(this._popupWnd+"_backdrop");c||(c=document.createElement("div"),c.setAttribute("id",this._popupWnd),c.setAttribute("tabindex","-1"),c.setAttribute("style","display:none;"),c.setAttribute("class","kament-modal kament-fade"),document.body.appendChild(c));d||(d=document.createElement("div"),d.setAttribute("id",this._popupWnd+"_backdrop"),d.setAttribute("style","display:none;"),
d.setAttribute("class","kament-modal-backdrop kament-fade"),document.body.appendChild(d));c.innerHTML=a;KAMENT.modal_onclose=b;c.setAttribute("style","display:block;");d.setAttribute("style","display:block;");setTimeout(function(){KAMENT.addClass(d,"kament-in");KAMENT.addClass(c,"kament-in")},10);c.focus()};
KAMENT.openProfileSettings=function(){void 0==this.modal_id?this.modal_id=0:this.modal_id++;var a="kament_settings_"+this.modal_id;KAMENT.openModal('<iframe  src="'+("//"+kament_subdomain+"."+KAMENT._domain+"/profileSettingsWidget")+'" id="'+a+'" name="kament_settings_'+this.modal_id+'" style="border:none;width:650px" scrolling="no" frameBorder="0" onload="KAMENT.FrameManager.registerFrame(document.getElementById(\''+a+"'))\"></iframe>",function(){pm({target:window.frames[KAMENT.main_iframe.id],
type:"userSettingsUpdated"})})};KAMENT.loginUpdate=function(a){pm({target:window.frames[KAMENT.main_iframe.id],type:"loginUpdate"})};KAMENT.onKeyDown=function(a){a=a||window.event;27==(a.keyCode||a.which)&&KAMENT.closeModal();KAMENT.alive=1};KAMENT.openAttachView=function(a,b){html='<div class="kament-attach-view"><img src="'+a[b].url+'"/></div>';KAMENT.openModal(html);KAMENT.addEvent(document,"click",KAMENT.closeModalOnClick)};
KAMENT.closeModalOnClick=function(a){console.log("CLICK!");KAMENT.closeModal();document.removeEventListener("click",KAMENT.closeModalOnClick)};KAMENT.scrollTo=function(a){if(KAMENT.main_iframe){0>a&&(a=0);var b=KAMENT.getOffset(KAMENT.main_iframe).top,c=25,d=(a+b-(document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop))/c,e=setInterval(function(){window.scrollBy(0,d);c--;0>=c&&clearInterval(e)},20)}};KAMENT.registerCallback=function(a,b){pm.bind("Event-"+a,b)};
KAMENT.FrameManager={init:function(){pm.bind("openProfileSettings",function(a){KAMENT.openProfileSettings()});pm.bind("openAttachView",function(a){KAMENT.openAttachView(a.attachments,a.current_id)});pm.bind("closeModal",function(a){KAMENT.closeModal()});pm.bind("KAMENT.scrollTo",function(a){KAMENT.scrollTo(a)});pm.bind("openPage",function(a){window.location.href=a})},registerFrame:function(a){var b={id:a.id};window.SVGameMasterPayload&&(b.gamemasterPayload=JSON.stringify(window.SVGameMasterPayload));
pm({target:window.frames[a.id],type:"register",data:b,url:a.contentWindow.location});pm.bind(a.id,function(a){var b=document.getElementById(a.id);null!=b&&(b.style.height=a.height.toString()+"px")})}};KAMENT.Init();
